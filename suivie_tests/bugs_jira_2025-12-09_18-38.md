# BUGS À CRÉER DANS JIRA - PROJET KAN

**Date**: 2025-12-09 18:38
**Source**: Tests Playwright sur http://localhost:3002
**Scénario testé**: Fonctionnalité 2FA (Authentification à deux facteurs)
**Total de bugs**: 3

---

## BUG #1 - Erreur 404 sur endpoint /profile

**Projet**: KAN
**Type**: Bug
**Priorité**: Medium

### Titre Jira
```
[API] Erreur 404 sur les requêtes vers /profile
```

### Description
```
## Problème
L'application génère des erreurs 404 lors de requêtes vers l'endpoint `/profile?_rsc=...`. Ces erreurs apparaissent de manière répétée dans la console à plusieurs moments de la navigation.

## Environnement
- URL: http://localhost:3002
- Navigateur: Chromium
- Détecté par: Tests Playwright

## Étapes de reproduction
1. Se connecter à l'application
2. Naviguer vers n'importe quelle page (Portfolio, Paramètres, etc.)
3. Ouvrir la console du navigateur
4. Observer les erreurs 404 répétées

## Résultat actuel
Erreurs console :
```
[ERROR] Failed to load resource: the server responded with a status of 404 (Not Found) @ http://localhost:3002/profile?_rsc=ovqpc
[ERROR] Failed to load resource: the server responded with a status of 404 (Not Found) @ http://localhost:3002/profile?_rsc=1mbyy
```

L'endpoint `/profile` semble ne pas être correctement implémenté ou accessible.

## Résultat attendu
Les requêtes vers `/profile` devraient retourner un statut 200 OK avec les données du profil utilisateur, ou ne pas être appelées si la page n'existe pas encore.

## Impact
- Pollution de la console avec des erreurs
- Possibles problèmes de performance dus aux requêtes échouées
- Mauvaise expérience développeur

## Critères d'acceptation
- [ ] Les requêtes vers /profile retournent un statut 200 OK
- [ ] Ou les requêtes vers /profile ne sont plus générées si la page n'est pas implémentée
- [ ] Aucune erreur 404 dans la console lors de la navigation
```

---

## BUG #2 - Erreur 404 sur chargement d'image QR Code

**Projet**: KAN
**Type**: Bug
**Priorité**: Low

### Titre Jira
```
[2FA] Erreur 404 lors du chargement de l'image QR Code
```

### Description
```
## Problème
Lors de l'activation de la 2FA, le QR Code s'affiche correctement mais génère une erreur 404 dans la console. L'URL de l'image semble être encodée en base64 directement dans l'URL au lieu d'utiliser un data URI.

## Environnement
- URL: http://localhost:3002/settings
- Navigateur: Chromium
- Détecté par: Tests Playwright - Scénario 2FA

## Étapes de reproduction
1. Se connecter à l'application
2. Aller dans Paramètres → Sécurité
3. Cliquer sur "Configurer 2FA"
4. Cliquer sur "Activer 2FA"
5. Observer la console

## Résultat actuel
Erreur console :
```
[ERROR] Failed to load resource: the server responded with a status of 404 (Not Found) @ http://localhost:3002/iVBORw0KGgoAAAANSUhEUgAAAcIAAAHCAQAAAABUY...
```

Le QR code s'affiche malgré l'erreur, mais l'URL ne devrait pas générer de requête HTTP.

## Résultat attendu
Le QR Code devrait utiliser un data URI (data:image/png;base64,...) au lieu d'une URL relative, évitant ainsi toute requête HTTP et erreur 404.

## Impact
- Erreur dans la console (bien que le QR code fonctionne)
- Requête HTTP inutile

## Critères d'acceptation
- [ ] Le QR Code utilise un data URI au lieu d'une URL relative
- [ ] Aucune erreur 404 lors de l'affichage du QR Code
- [ ] Le QR Code continue de s'afficher correctement
```

---

## BUG #3 - Déconnexion lors du premier clic sur "Configurer 2FA"

**Projet**: KAN
**Type**: Bug
**Priorité**: High

### Titre Jira
```
[2FA] L'utilisateur est déconnecté au premier clic sur "Configurer 2FA"
```

### Description
```
## Problème
Lors du premier clic sur le bouton "Configurer 2FA", l'application effectue une requête vers `/api/v1/mfa/status` qui retourne une erreur 401 (Unauthorized), ce qui déclenche une déconnexion automatique de l'utilisateur et une redirection vers la page de login.

Au second clic (après reconnexion), le dialog s'ouvre correctement.

## Environnement
- URL: http://localhost:3002/settings
- API: http://localhost:8001
- Navigateur: Chromium
- Détecté par: Tests Playwright - Scénario 2FA

## Étapes de reproduction
1. Se connecter à l'application avec les credentials : test@test.com / TestPassword123
2. Aller dans Paramètres → onglet Sécurité
3. Cliquer sur "Configurer 2FA" (premier clic)
4. Observer la redirection vers /login

## Résultat actuel
```
[ERROR] Failed to load resource: the server responded with a status of 401 (Unauthorized) @ http://localhost:8001/api/v1/mfa/status
```

L'utilisateur est déconnecté et redirigé vers la page de login. Il doit se reconnecter pour accéder au dialog 2FA.

## Résultat attendu
Le dialog 2FA devrait s'ouvrir directement au premier clic sans déconnecter l'utilisateur. La requête vers `/api/v1/mfa/status` devrait inclure un token d'authentification valide ou gérer l'erreur 401 sans déconnecter l'utilisateur.

## Impact
- Expérience utilisateur très dégradée
- L'utilisateur doit se reconnecter à chaque tentative
- Bloque l'activation de la 2FA lors de la première tentative

## Pistes de solution
1. Vérifier que le token d'authentification est bien inclus dans la requête vers `/api/v1/mfa/status`
2. Vérifier que le middleware d'authentification de l'API accepte le token
3. Gérer l'erreur 401 sans déclencher de déconnexion automatique (peut-être afficher un message d'erreur au lieu de rediriger)

## Critères d'acceptation
- [ ] Le bouton "Configurer 2FA" ouvre le dialog au premier clic
- [ ] Aucune erreur 401 sur l'endpoint `/api/v1/mfa/status`
- [ ] L'utilisateur reste connecté même en cas d'erreur
- [ ] Le token d'authentification est correctement transmis dans les headers
```

---

## RÉSUMÉ DES TESTS RÉUSSIS

Malgré les bugs identifiés ci-dessus, les fonctionnalités suivantes ont été testées avec succès :

### Fonctionnalités OK :
1. Navigation vers Paramètres → Sécurité : OK
2. Affichage de l'onglet Sécurité avec le bouton "Configurer 2FA" : OK
3. Ouverture du dialog 2FA (après reconnexion) : OK
4. Affichage du statut 2FA (Inactif) : OK
5. Bouton "Activer 2FA" : OK
6. Affichage du QR Code : OK (malgré l'erreur 404)
7. Affichage du secret manuel en base32 : OK
8. Champ de saisie du code à 6 chiffres : OK
9. Validation du code invalide : OK
10. Message d'erreur "Invalid TOTP code. Please try again." : OK (en rouge)
11. Bouton "Vérifier et activer" devient actif après saisie : OK
12. Fermeture du dialog avec bouton "Close" : OK
13. Utilisateur reste connecté après fermeture du dialog : OK

### Éléments UI vérifiés :
- Dialog avec titre "Authentification à deux facteurs (2FA)"
- Description : "Ajoutez une couche de sécurité supplémentaire à votre compte"
- Statut 2FA clairement affiché
- QR Code visible
- Secret manuel : `QP4T3GPL3AI3TR5AOZ425HAJB5IQS4RQ`
- Placeholder du champ : "000000"
- Boutons : "Retour", "Vérifier et activer", "Close"

---

## RECOMMANDATIONS

1. **BUG #3 (HIGH)** : À corriger en priorité car il bloque l'utilisation de la 2FA
2. **BUG #1 (MEDIUM)** : À corriger pour nettoyer les erreurs console
3. **BUG #2 (LOW)** : Correction cosmétique, le QR code fonctionne malgré l'erreur
